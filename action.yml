name: Notify Slack
description: Notify Slack
inputs:
  channel_id: # channel id to post message when using bot token
    description: 'Slack channel ID where message will be posted. Needed if using bot token'
    required: false
  outcome:
    description: "Tells the action if it's a success outcome"
    required: false
    default: 'failure'
  token:
    description: "Slack app api token"
    required: true
runs:
  using: composite
  steps:
    - name: Send success slack notification
      if: ${{ inputs.outcome == 'success' }}
      shell: bash
      run: |
        curl -X POST https://slack.com/api/chat.postMessage \
             -H "Authorization: Bearer xoxb-${{ inputs.token }}" \
             -H "Accept: application/json" \
             -H "Content-Type: application/json" \
             -d '{ \x22channel\x22: \x22${{ inputs.channel_id }}\x22, \x22blocks\x22: [{ \x22type\x22: \x22section\x22, \x22text\x22: { \x22type\x22: \x22mrkdwn\x22, \x22text\x22: \x22*status:* success \x22 } }, { \x22type\x22: \x22section\x22, \x22text\x22: { \x22type\x22: \x22mrkdwn\x22, \x22text\x22: \x22*repository:* ${{ github.repository }}\x22 } }, { \x22type\x22: \x22divider\x22 }, { \x22type\x22: \x22section\x22, \x22text\x22: { \x22type\x22: \x22mrkdwn\x22, \x22text\x22: \x22Action success\x22 } }, { \x22type\x22: \x22section\x22, \x22text\x22: { \x22type\x22: \x22mrkdwn\x22, \x22text\x22: \x22Check it by clicking the button\x22 }, \x22accessory\x22: { \x22type\x22: \x22button\x22, \x22text\x22: { \x22type\x22: \x22plain_text\x22, \x22text\x22: \x22PR Url\x22, \x22emoji\x22: true }, \x22value\x22: \x22click_me_123\x22, \x22url\x22: \x22${{ github.event.pull_request.html_url }}\x22, \x22action_id\x22: \x22button-action\x22 } } ]}'


    - name: Send failure slack notification
      if: ${{ inputs.outcome == 'failure' }}
      shell: bash
      run: |
        curl -H "Content-Type: application/json" \
             -H "Authorization: Bearer xoxb-${{ inputs.token }}" \
             -X POST https://slack.com/api/chat.postMessage \
            --data \
        "
        {
          \"channel\": ${{ inputs.channel_id }},
          \"blocks\": [
            {
              \"type\": \"section\",
              \"text\": {
                \"type\": \"mrkdwn\",
                \"text\": \"*status:* failure \"
              }
            },
            {
              \"type\": \"section\",
              \"text\": {
                \"type\": \"mrkdwn\",
                \"text\": \"*repository:* ${{ github.repository }} \"
              }
            },
            {
              \"type\": \"divider\"
            },
            {
              \"type\": \"section\",
              \"text\": {
                \"type\": \"mrkdwn\",
                \"text\": \"Action success\"
              }
            },
            {
              \"type\": \"section\",
              \"text\": {
                \"type\": \"mrkdwn\",
                \"text\": \"Check it by clicking the button\"
              },
              \"accessory\": {
                \"type\": \"button\",
                \"text\": {
                  \"type\": \"plain_text\",
                  \"text\": \"PR Url\",
                  \"emoji\": true
                },
                \"value\": \"click_me_123\",
                \"url\": ${{ github.event.pull_request.html_url }},
                \"action_id\": \"button-action\"
              }
            }
          ]
        }"
